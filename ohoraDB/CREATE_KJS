-- 시퀀스 생성
CREATE SEQUENCE O_USER_SEQ NOCACHE;
CREATE SEQUENCE O_ORDER_SEQ NOCACHE;
CREATE SEQUENCE O_ORDDETAIL_SEQ NOCACHE;
CREATE SEQUENCE ADDCART_SEQ NOCACHE;
CREATE SEQUENCE O_ADDR_SEQ NOCACHE;

/* 멤버십 */
CREATE TABLE O_MEMBERSHIP (
    MEM_ID NUMBER NOT NULL,
    MEM_NAME VARCHAR2(10),
    MEM_BENEFIT NUMBER,
    MEM_GRADE_TIER NUMBER,
    CONSTRAINT PK_O_MEMBERSHIP PRIMARY KEY (MEM_ID)
);

/* 권한 */
CREATE TABLE O_AUTH (
    AUTH_ID NUMBER NOT NULL,
    AUTH_NAME VARCHAR2(20),
    CONSTRAINT PK_O_AUTH PRIMARY KEY (AUTH_ID)
);

/* 카테고리 */
CREATE TABLE O_CATEGORY (
    CAT_ID NUMBER NOT NULL,
    CAT_NAME NVARCHAR2(20) NOT NULL,
    CONSTRAINT PK_O_CATEGORY PRIMARY KEY (CAT_ID)
);

/* 하위카테고리 */
CREATE TABLE O_SUBCATEGORY (
    SCAT_ID NUMBER NOT NULL,
    SCAT_NAME NVARCHAR2(20) NOT NULL,
    CONSTRAINT PK_O_SUBCATEGORY PRIMARY KEY (SCAT_ID)
);

/* 회원 */
CREATE TABLE O_USER (
    USER_ID NUMBER NOT NULL,
    MEM_ID NUMBER,
    AUTH_ID NUMBER,
    USER_LOGIN_ID VARCHAR2(20) NOT NULL,
    USER_PASSWORD VARCHAR2(100) NOT NULL,
    USER_NAME NVARCHAR2(10) NOT NULL,
    USER_EMAIL VARCHAR2(100) NOT NULL,
    USER_TEL VARCHAR2(20) NOT NULL,
    USER_BIRTH DATE NOT NULL,
    USER_POINT NUMBER DEFAULT 0,
    USER_SNSAGREE CHAR(1) DEFAULT 'N',
    USER_JOINDATE DATE,
    CONSTRAINT PK_O_USER PRIMARY KEY (USER_ID),
    CONSTRAINT UK_O_USER UNIQUE (USER_LOGIN_ID, USER_EMAIL),
    CONSTRAINT FK_O_MEMBERSHIP_TO_O_USER FOREIGN KEY (MEM_ID) REFERENCES O_MEMBERSHIP (MEM_ID),
    CONSTRAINT FK_O_AUTH_TO_O_USER FOREIGN KEY (AUTH_ID) REFERENCES O_AUTH (AUTH_ID)
);

/* 상품 */
CREATE TABLE O_PRODUCT (
    PDT_ID NUMBER NOT NULL,
    CAT_ID NUMBER,
    SCAT_ID NUMBER,
    PDT_NUMBER NUMBER DEFAULT 0,
    PDT_NAME NVARCHAR2(50) NOT NULL,
    PDT_AMOUNT NUMBER,
    PDT_DISCOUNT_RATE NUMBER DEFAULT 0,
    PDT_IMG_URL VARCHAR2(100),
    PDT_COUNT NUMBER DEFAULT 0 NOT NULL,
    PDT_REVIEW_COUNT NUMBER DEFAULT 0 NOT NULL,
    PDT_SALES_COUNT NUMBER DEFAULT 0 NOT NULL,
    PDT_ADDDATE DATE NOT NULL,
    PDT_VIEWCOUNT NUMBER DEFAULT 0 NOT NULL,
    PDT_IMG_URL2 VARCHAR2(100),
    CONSTRAINT PK_O_PRODUCT PRIMARY KEY (PDT_ID),
    CONSTRAINT FK_O_CATEGORY_TO_O_PRODUCT FOREIGN KEY (CAT_ID) REFERENCES O_CATEGORY (CAT_ID),
    CONSTRAINT FK_O_SUBCATEGORY_TO_O_PRODUCT FOREIGN KEY (SCAT_ID) REFERENCES O_SUBCATEGORY (SCAT_ID)
);

/* 주문 */
CREATE TABLE O_ORDER (
    ORD_PK NUMBER NOT NULL,
    ORD_ID VARCHAR2(30) NOT NULL,
    USER_ID NUMBER,
    ICPN_ID NUMBER,
    ORD_NAME NVARCHAR2(10),
    ORD_ADDRESS NVARCHAR2(200),
    ORD_ZIPCODE CHAR(5) NOT NULL,
    ORD_TEL VARCHAR2(20),
    ORD_EMAIL VARCHAR2(100),
    ORD_PASSWORD VARCHAR2(50),
    ORD_ORDERDATE DATE,
    ORD_TOTAL_AMOUNT NUMBER DEFAULT 0,
    ORD_CPN_DISCOUNT NUMBER DEFAULT 0,
    ORD_PDT_DISCOUNT NUMBER DEFAULT 0,
    ORD_USEPOINT NUMBER,
    ORD_PAY_OPTION VARCHAR2(30),
    ORD_DELIVERY_FEE NUMBER DEFAULT 3000,
    CONSTRAINT PK_O_ORDER PRIMARY KEY (ORD_PK),
    CONSTRAINT FK_O_USER_TO_O_ORDER FOREIGN KEY (USER_ID) REFERENCES O_USER (USER_ID)
);

/* 주문상세 */
CREATE TABLE O_ORDDETAIL (
    OPDT_ID NUMBER NOT NULL,
    ORD_PK NUMBER NOT NULL,
    OPDT_NAME NVARCHAR2(50),
    OPDT_AMOUNT NUMBER DEFAULT 0,
    OPDT_DCAMOUNT NUMBER DEFAULT 0,
    OPDT_OPNAME NVARCHAR2(20),
    OPDT_OPAMOUNT NUMBER DEFAULT 0,
    OPDT_COUNT NUMBER,
    OPDT_STATE NVARCHAR2(30),
    OPDT_REFUND NVARCHAR2(30),
    OPDT_DELCOMPANY NVARCHAR2(30),
    OPDT_DELNUMBER VARCHAR2(30),
    OPDT_CONFIRM CHAR(1) DEFAULT 'N',
    CONSTRAINT PK_O_ORDDETAIL PRIMARY KEY (OPDT_ID, ORD_PK),
    CONSTRAINT FK_O_ORDER_TO_O_ORDDETAIL FOREIGN KEY (ORD_PK) REFERENCES O_ORDER (ORD_PK)
);

/* 리뷰 */
CREATE TABLE O_REVIEW (
    REV_ID NUMBER NOT NULL,
    USER_ID NUMBER,
    ORD_PK NUMBER,
    OPDT_ID NUMBER,
    REV_CONTENT VARCHAR2(1500) NOT NULL,
    REV_WRITEDATE DATE NOT NULL,
    REV_RATING NUMBER(1) DEFAULT 5 NOT NULL,
    REV_GOOD_COUNT NUMBER DEFAULT 0,
    REV_BAD_COUNT NUMBER,
    REV_COMMENT_COUNT NUMBER DEFAULT 0,
    REV_ISRECOMMEND CHAR(1) DEFAULT 'N',
    REV_ISPHOTO CHAR(1) DEFAULT 'N',
    REV_AGE_GROUP VARCHAR2(20),
    REV_OPTION VARCHAR2(20),
    CONSTRAINT PK_O_REVIEW PRIMARY KEY (REV_ID),
    CONSTRAINT FK_O_USER_TO_O_REVIEW FOREIGN KEY (USER_ID) REFERENCES O_USER (USER_ID),
    CONSTRAINT FK_O_ORDDETAIL_TO_O_REVIEW FOREIGN KEY (OPDT_ID, ORD_PK) REFERENCES O_ORDDETAIL (OPDT_ID, ORD_PK)
);

/* 쿠폰 */
CREATE TABLE O_COUPON (
    CPN_ID NUMBER NOT NULL,
    CPN_DISCOUNT_RATE NUMBER,
    CPN_INFO NVARCHAR2(50),
    CPN_STARTDATE DATE,
    CPN_APPLY CHAR(1) DEFAULT 'P',
    CPN_ENDDATE DATE,
    CPN_MAX_AMOUNT NUMBER,
    CPN_CON_VALUE VARCHAR2(30),
    CPN_CON_TYPE VARCHAR2(15),
    CPN_DISCOUNT_TYPE CHAR(1),
    CONSTRAINT PK_O_COUPON PRIMARY KEY (CPN_ID)
);

/* 결제 */
CREATE TABLE O_PAYMENT (
    PAY_ID NUMBER NOT NULL,
    ORD_PK NUMBER NOT NULL,
    USER_ID NUMBER,
    PAY_AMOUNT NUMBER,
    PAY_DATE DATE,
    PAY_OPTION VARCHAR2(30),
    PAY_STATE VARCHAR2(30),
    PAY_TRADE_NUMBER VARCHAR2(30),
    CONSTRAINT PK_O_PAYMENT PRIMARY KEY (PAY_ID, ORD_PK),
    CONSTRAINT UK_O_PAYMENT UNIQUE (PAY_TRADE_NUMBER),
    CONSTRAINT FK_O_ORDER_TO_O_PAYMENT FOREIGN KEY (ORD_PK) REFERENCES O_ORDER (ORD_PK),
    CONSTRAINT FK_O_USER_TO_O_PAYMENT FOREIGN KEY (USER_ID) REFERENCES O_USER (USER_ID)
);

/* 댓글 */
CREATE TABLE O_COMMENT (
    CMT_ID NUMBER NOT NULL,
    REV_ID NUMBER,
    USER_ID NUMBER,
    CMT_WRITEDATE DATE NOT NULL,
    CMT_CONTENT CLOB NOT NULL,
    CONSTRAINT PK_O_COMMENT PRIMARY KEY (CMT_ID),
    CONSTRAINT FK_O_REVIEW_TO_O_COMMENT FOREIGN KEY (REV_ID) REFERENCES O_REVIEW (REV_ID),
    CONSTRAINT FK_O_USER_TO_O_COMMENT FOREIGN KEY (USER_ID) REFERENCES O_USER (USER_ID)
);

/* 라인업 */
CREATE TABLE O_LINEUP (
    LINEUP_ID NUMBER NOT NULL,
    LINEUP_OPTION NVARCHAR2(20) NOT NULL,
    CONSTRAINT PK_O_LINEUP PRIMARY KEY (LINEUP_ID)
);

/* 디자인 */
CREATE TABLE O_DESIGN (
    DESIGN_ID NUMBER NOT NULL,
    DESIGN_OPTION NVARCHAR2(20) NOT NULL,
    CONSTRAINT PK_O_DESIGN PRIMARY KEY (DESIGN_ID)
);

/* 컬러 */
CREATE TABLE O_COLOR (
    COLOR_ID NUMBER NOT NULL,
    COLOR_OPTION NVARCHAR2(20) NOT NULL,
    CONSTRAINT PK_O_COLOR PRIMARY KEY (COLOR_ID)
);

/* 장바구니 목록 */
CREATE TABLE O_CARTLIST (
    CLIST_ID NUMBER NOT NULL,
    USER_ID NUMBER,
    PDT_ID NUMBER,
    OPT_ID NUMBER,
    CLIST_PDT_COUNT NUMBER,
    CLIST_ADDDATE DATE,
    CLIST_SELECT CHAR(1) DEFAULT 'Y',
    CONSTRAINT PK_O_CARTLIST PRIMARY KEY (CLIST_ID),
    CONSTRAINT FK_O_USER_TO_O_CARTLIST FOREIGN KEY (USER_ID) REFERENCES O_USER (USER_ID),
    CONSTRAINT FK_O_PRODUCT_TO_O_CARTLIST FOREIGN KEY (PDT_ID) REFERENCES O_PRODUCT (PDT_ID)
);

/* 발급쿠폰 */
CREATE TABLE O_ISSUEDCOUPON (
    ICPN_ID NUMBER NOT NULL,
    USER_ID NUMBER,
    CPN_ID NUMBER,
    ICPN_ISSUEDATE DATE,
    ICPN_ISUSED CHAR(1) DEFAULT 'N',
    CONSTRAINT PK_O_ISSUEDCOUPON PRIMARY KEY (ICPN_ID),
    CONSTRAINT FK_O_USER_TO_O_ISSUEDCOUPON FOREIGN KEY (USER_ID) REFERENCES O_USER (USER_ID),
    CONSTRAINT FK_O_COUPON_TO_O_ISSUEDCOUPON FOREIGN KEY (CPN_ID) REFERENCES O_COUPON (CPN_ID)
);

/* 배송지 */
CREATE TABLE O_ADDRESS (
    ADDR_ID NUMBER NOT NULL,
    USER_ID NUMBER,
    ADDR_NICK NVARCHAR2(20) NOT NULL,
    ADDR_NAME NVARCHAR2(10) NOT NULL,
    ADDR_HTEL VARCHAR2(20),
    ADDR_TEL VARCHAR2(20) NOT NULL,
    ADDR_ADDRESS_MAIN NVARCHAR2(100) NOT NULL,
    ADDR_ADDRESS_DETAIL NVARCHAR2(100),
    ADDR_ZIPCODE CHAR(5) NOT NULL,
    ADDR_MAIN CHAR(1) DEFAULT 'N',
    CONSTRAINT PK_O_ADDRESS PRIMARY KEY (ADDR_ID),
    CONSTRAINT FK_O_USER_TO_O_ADDRESS FOREIGN KEY (USER_ID) REFERENCES O_USER (USER_ID)
);

/* 상품옵션 */
CREATE TABLE O_PDTOPTION (
    OPT_ID NUMBER NOT NULL,
    PDT_ID NUMBER,
    OPT_NAME NVARCHAR2(20) NOT NULL,
    OPT_AMOUNT NUMBER DEFAULT 0,
    OPT_COUNT NUMBER DEFAULT 0,
    CONSTRAINT PK_O_PDTOPTION PRIMARY KEY (OPT_ID),
    CONSTRAINT FK_O_PRODUCT_TO_O_PDTOPTION FOREIGN KEY (PDT_ID) REFERENCES O_PRODUCT (PDT_ID)
);

/* 상품별 컬러 항목 */
CREATE TABLE O_PDTCOLOR (
    PDT_ID NUMBER,
    COLOR_ID NUMBER,
    CONSTRAINT FK_O_PRODUCT_TO_O_PDTCOLOR FOREIGN KEY (PDT_ID) REFERENCES O_PRODUCT (PDT_ID),
    CONSTRAINT FK_O_COLOR_TO_O_PDTCOLOR FOREIGN KEY (COLOR_ID) REFERENCES O_COLOR (COLOR_ID)
);

/* 상품별 라인업 항목 */
CREATE TABLE O_PDTLINEUP (
    PDT_ID NUMBER,
    LINEUP_ID NUMBER,
    CONSTRAINT FK_O_PRODUCT_TO_O_PDTLINEUP FOREIGN KEY (PDT_ID) REFERENCES O_PRODUCT (PDT_ID),
    CONSTRAINT FK_O_LINEUP_TO_O_PDTLINEUP FOREIGN KEY (LINEUP_ID) REFERENCES O_LINEUP (LINEUP_ID)
);

/* 상품별 디자인 항목 */
CREATE TABLE O_PDTDESIGN (
    PDT_ID NUMBER,
    DESIGN_ID NUMBER,
    CONSTRAINT FK_O_PRODUCT_TO_O_PDTDESIGN FOREIGN KEY (PDT_ID) REFERENCES O_PRODUCT (PDT_ID),
    CONSTRAINT FK_O_DESIGN_TO_O_PDTDESIGN FOREIGN KEY (DESIGN_ID) REFERENCES O_DESIGN (DESIGN_ID)
);

/* FAQ카테고리 */
CREATE TABLE O_FAQCATEGORY (
    FCAT_ID NUMBER NOT NULL,
    FCAT_NAME NVARCHAR2(15),
    CONSTRAINT PK_O_FAQCATEGORY PRIMARY KEY (FCAT_ID)
);

/* FAQ */
CREATE TABLE O_FAQ (
    FAQ_ID NUMBER NOT NULL,
    FCAT_ID NUMBER,
    USER_ID NUMBER NOT NULL,
    FAQ_TITLE NVARCHAR2(50) NOT NULL,
    FAQ_CONTENT VARCHAR2(3000),
    FAQ_WRITER NVARCHAR2(10),
    FAQ_VIEWCOUNT NUMBER DEFAULT 0,
    FAQ_WRITEDATE DATE,
    FAQ_MODIFYDATE DATE,
    CONSTRAINT PK_O_FAQ PRIMARY KEY (FAQ_ID),
    CONSTRAINT FK_O_FAQCATEGORY_TO_O_FAQ FOREIGN KEY (FCAT_ID) REFERENCES O_FAQCATEGORY (FCAT_ID),
    CONSTRAINT FK_O_USER_TO_O_FAQ FOREIGN KEY (USER_ID) REFERENCES O_USER (USER_ID)
);

/* NOTICE */
CREATE TABLE O_NOTICE (
    NOTICE_ID NUMBER NOT NULL,
    USER_ID NUMBER NOT NULL,
    NOTICE_TITLE NVARCHAR2(50) NOT NULL,
    NOTICE_CONTENT VARCHAR2(3000),
    NOTICE_WRITER NVARCHAR2(10),
    NOTICE_VIEWCOUNT NUMBER DEFAULT 0,
    NOTICE_WRITEDATE DATE,
    NOTICE_MODIFYDATE DATE,
    CONSTRAINT PK_O_NOTICE PRIMARY KEY (NOTICE_ID),
    CONSTRAINT FK_O_USER_TO_O_NOTICE FOREIGN KEY (USER_ID) REFERENCES O_USER (USER_ID)
);

/* 1:1게시판 */
CREATE TABLE O_ASK (
    ASK_ID NUMBER NOT NULL,
    USER_ID NUMBER,
    ASK_TITLE NVARCHAR2(50),
    ASK_CONTENT VARCHAR2(3000),
    ASK_WRITER NVARCHAR2(10),
    ASK_WRITEDATE DATE,
    ASK_MODIFYDATE DATE,
    ASK_ISANSWER CHAR(1) DEFAULT 'X',
    CONSTRAINT PK_O_ASK PRIMARY KEY (ASK_ID),
    CONSTRAINT FK_O_USER_TO_O_ASK FOREIGN KEY (USER_ID) REFERENCES O_USER (USER_ID)
);

/* 리뷰URL */
CREATE TABLE O_REVURL (
    RURL_ID NUMBER NOT NULL,
    REV_ID NUMBER NOT NULL,
    RURL_PHOTO VARCHAR2(100),
    RURL_RECORD VARCHAR2(100),
    CONSTRAINT PK_O_REVURL PRIMARY KEY (RURL_ID, REV_ID),
    CONSTRAINT FK_O_REVIEW_TO_O_REVURL FOREIGN KEY (REV_ID) REFERENCES O_REVIEW (REV_ID)
);

/* URL 컬럼 크기 변경 */
ALTER TABLE O_PRODUCT MODIFY PDT_IMG_URL VARCHAR2(100 CHAR);
ALTER TABLE O_PRODUCT MODIFY PDT_IMG_URL2 VARCHAR2(100 CHAR);

/* 이벤트 */
CREATE TABLE O_EVENT (
    EVT_ID NUMBER NOT NULL,
    EVT_TITLE NVARCHAR2(50),
    EVT_CONTENT VARCHAR2(3000),
    EVT_STARTDATE DATE NOT NULL,
    EVT_ENDDATE DATE NOT NULL,
    EVT_CONTENT_URL VARCHAR2(50),
    CONSTRAINT PK_O_EVENT PRIMARY KEY (EVT_ID)
);

COMMIT;
